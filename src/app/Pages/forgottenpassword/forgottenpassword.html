<div class="fp-page">
  <div class="card">
    <div class="card-header">
      <div class="icon-circle">ğŸ”</div>
      <h2>Forgot Password</h2>
      <p class="subtitle">Weâ€™ll send you a one-time code to reset your password</p>
    </div>

    <div class="stepper">
      <div class="step-node" [class.active]="step >= 1" [class.completed]="step > 1">
        <span>1</span>
        <div class="label">Email</div>
      </div>
      <div class="step-connector" [class.filled]="step > 1"></div>
      <div class="step-node" [class.active]="step >= 2" [class.completed]="step > 2">
        <span>2</span>
        <div class="label">OTP</div>
      </div>
      <div class="step-connector" [class.filled]="step > 2"></div>
      <div class="step-node" [class.active]="step >= 3" [class.completed]="step > 3">
        <span>3</span>
        <div class="label">Reset</div>
      </div>
    </div>

    <div class="alerts">
      <div class="alert error" *ngIf="errorMessage">{{ errorMessage }}</div>
      <div class="alert success" *ngIf="successMessage">{{ successMessage }}</div>
    </div>

    <!-- Step 1: Enter Email -->
    <form class="step animate-in" *ngIf="step === 1" [formGroup]="emailForm" (ngSubmit)="sendOtp()">
      <div class="form-row">
        <label for="email">Email</label>
        <input id="email" type="email" formControlName="email" placeholder="name@example.com" />
        <small class="hint">Use the email associated with your account</small>
      </div>
      <button class="btn primary" type="submit" [disabled]="loading">
        <span class="spinner" *ngIf="loading"></span>
        <span>{{ loading ? 'Sending...' : 'Send OTP' }}</span>
      </button>
    </form>

    <!-- Step 2: Enter OTP -->
    <form class="step animate-in" *ngIf="step === 2" [formGroup]="otpForm" (ngSubmit)="saveOtp()">
      <div class="form-row">
        <label>One-time code</label>
        <div class="otp-grid">
          <input
            *ngFor="let ctrl of otpControls; index as i"
            #otpBox
            class="otp-box"
            type="text"
            [formControl]="ctrl"
            inputmode="numeric"
            pattern="[0-9]*"
            maxlength="1"
            autocomplete="one-time-code"
            (input)="onOtpInput($event, i)"
            (keydown)="onOtpKeyDown($event, i)"
            (paste)="onOtpPaste($event)"
          />
        </div>
        <small class="hint">Enter the 6-digit code we sent to your email</small>
      </div>
      <button class="btn primary" type="submit" [disabled]="loading || otpForm.invalid">
        <span>Next</span>
      </button>
    </form>

    <!-- Step 3: Enter New Password -->
    <form class="step animate-in" *ngIf="step === 3" [formGroup]="passwordForm" (ngSubmit)="resetPassword()">
      <div class="form-row">
        <label for="password">New password</label>
        <input id="password" type="password" formControlName="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
      </div>

      <div class="form-row">
        <label for="confirmPassword">Confirm password</label>
        <input id="confirmPassword" type="password" formControlName="confirmPassword" placeholder="Repeat the password" />
      </div>

      <button class="btn success" type="submit" [disabled]="loading">
        <span class="spinner" *ngIf="loading"></span>
        <span>{{ loading ? 'Resetting...' : 'Reset Password' }}</span>
      </button>
    </form>
  </div>
</div>

<!-- Success Banner -->
<div *ngIf="showSuccessBanner" class="success-banner fade-in">
  <div>Password reset successful ğŸ‰</div>
  <div class="sub">Redirecting to home...</div>
  <div class="progress"></div>
  </div>
